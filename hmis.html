<!DOCTYPE html>
<html lang="vi" x-data="{ 
        section: 'overview', 
        showLayer: 'arch', 
        darkMode: localStorage.getItem('darkMode') === 'true', 
        mobileMenu: false,
        showModal: false, 
        showAudit: false,
        selectedCriteria: 'C2.1',
        selectedIssue: null, 
        liveKwh: 2450.8, temp: 24.2, humid: 55, aqi: 22,
        /* --- DỮ LIỆU VỆ SINH THÔNG LUỒNG --- */
        housekeepingLogs: [],
        lastHkUpdate: 'Đang kết nối...',
        pcccIssue: {
            location: 'Hành lang khu Cấp cứu (Phía Đông)',
            status: 'Cảnh báo: Áp suất thấp (Low Pressure)',
            detail: 'Hệ thống phát hiện sụt giảm áp suất tại cụm vòi phun số 04. Có khả năng rò rỉ tại van chặn tầng 1.',
            action: '1. Kiểm tra trạm bơm bù áp.\n2. Kiểm tra trực tiếp van khu vực C.\n3. Thông báo đội kỹ thuật trực ca.'
        }
    }" :class="{ 'dark': darkMode }" x-init="$watch('darkMode', val => localStorage.setItem('darkMode', val))">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCP HMIS - Hospital Management Platform</title>
    <meta name="robots" content="noindex, nofollow">

    <!-- External Fonts & Libraries -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        scp: { bg: '#0f172a', card: '#1e293b', primary: '#0d9488', accent: '#22d3ee' }
                    },
                    animation: { 'fade-in': 'fadeIn 0.5s ease-out forwards' },
                    keyframes: { fadeIn: { '0%': { opacity: '0', transform: 'scale(0.98)' }, '100%': { opacity: '1', transform: 'scale(1)' } } }
                }
            }
        }
    </script>

    <!-- Custom Stylesheets -->
    <link rel="stylesheet" href="Archive/Legacy_Web_App/assets/css/main.css">
    <link rel="stylesheet" href="Archive/Legacy_Web_App/assets/css/components.css">

    <!-- External JavaScript Libraries -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>

    <!-- Application JavaScript Modules -->
    <script src="Archive/Legacy_Web_App/assets/js/data-service.js"></script>
    <script src="Archive/Legacy_Web_App/assets/js/charts.js"></script>
    <script src="Archive/Legacy_Web_App/assets/js/app.js"></script>
    <script src="Archive/Legacy_Web_App/assets/js/sidebar-sync.js"></script>
</head>

<body :class="darkMode ? 'dark' : 'light'" x-init="
    setInterval(() => { liveKwh = (parseFloat(liveKwh) + 0.5).toFixed(1); }, 2000);
    setInterval(() => { temp = (24 + Math.random()).toFixed(1); humid = Math.floor(50 + Math.random() * 10); aqi = Math.floor(20 + Math.random() * 10); }, 3000);
">
    <div class="app-wrapper">
        <aside class="sidebar">
            <div class="flex items-center justify-center h-full">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"></div>
            </div>
        </aside>

        <div class="main-container">
            <header class="main-header shadow-sm">
                <div>
                    <h2 class="text-[10px] text-teal-600 font-bold uppercase tracking-widest">Cơ sở: Bệnh viện Quốc tế
                        SCP</h2>
                    <h3 class="text-2xl font-black uppercase tracking-tight transition-colors"
                        :class="darkMode ? 'text-white' : 'text-slate-800'">TRUNG TÂM ĐIỀU HÀNH HMIS</h3>
                </div>
                <div class="text-right">
                    <p class="text-[9px] opacity-50 uppercase font-bold transition-colors"
                        :class="darkMode ? 'text-white' : 'text-slate-900'">Tiêu thụ năng lượng</p>
                    <p class="text-xl font-black text-teal-600 tracking-tighter" x-text="liveKwh + ' kWh'"></p>
                </div>
            </header>

            <div class="content-scroll">
                <div x-show="section === 'overview'" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 gap-4">
                        <div class="stat-card border-teal-500/20"><span
                                class="text-[9px] font-bold text-slate-500 uppercase block">P. Mổ vô trùng</span>
                            <div class="text-xl font-black text-teal-600" x-text="temp + '°C'"></div>
                            <div class="h-[45px] mt-2"><canvas id="chartTemp"></canvas></div>
                        </div>
                        <div class="stat-card border-cyan-500/20"><span
                                class="text-[9px] font-bold text-slate-500 uppercase block">Độ ẩm kho thuốc</span>
                            <div class="text-xl font-black text-cyan-600" x-text="humid + '%'"></div>
                            <div class="h-[45px] mt-2"><canvas id="chartHumid"></canvas></div>
                        </div>
                        <div class="stat-card border-indigo-500/20"><span
                                class="text-[9px] font-bold text-slate-500 uppercase block"
                                :class="darkMode ? 'text-white' : 'text-slate-800'">Chất lượng khí</span>
                            <div class="text-xl font-black text-indigo-500" x-text="aqi"></div>
                            <div class="h-[45px] mt-2"><canvas id="chartAQI"></canvas></div>
                        </div>
                        <div class="stat-card"><span class="text-[9px] font-bold text-slate-500 uppercase block">Bệnh
                                nhân</span>
                            <div class="text-xl font-black" :class="darkMode ? 'text-white' : 'text-teal-900'">1,240
                            </div>
                            <div class="mt-4 text-[8px] text-teal-600 font-bold uppercase"><i
                                    class="fas fa-caret-up"></i> 2.5%</div>
                        </div>

                        <div class="stat-card border-teal-500/20"><span
                                class="text-[9px] font-bold text-slate-500 uppercase block">Tiếp nhận / Ngày</span>
                            <div class="text-xl font-black text-teal-600">444</div>
                            <div class="mt-4 h-1 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                <div class="bg-teal-500 h-full w-[75%]"></div>
                            </div>
                        </div>

                        <div class="stat-card"><span class="text-[9px] font-bold text-slate-500 uppercase block">Giường
                                trống</span>
                            <div class="text-xl font-black" :class="darkMode ? 'text-white' : 'text-slate-800'">42/500
                            </div>
                            <div class="mt-4 h-1 bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                                <div class="bg-teal-500 h-full w-[91%]"></div>
                            </div>
                        </div>
                        <div class="stat-card border-orange-500/20"><span
                                class="text-[9px] font-bold text-slate-500 uppercase block">Viện phí/Ngày</span>
                            <div class="text-xl font-black text-orange-600">845 Tr</div>
                            <div class="h-[45px] mt-2"><canvas id="chartFee"></canvas></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="stat-card flex flex-col">
                            <h4 class="text-[10px] font-bold uppercase mb-4 text-teal-600 flex justify-between">
                                <span>Giám sát khu Cấp cứu</span><span
                                    class="text-red-500 animate-pulse font-black">LIVE</span>
                            </h4>
                            <div class="cam-container border border-teal-100 dark:border-slate-700 relative mb-4"><img
                                    src="https://images.unsplash.com/photo-1516549655169-df83a0774514?auto=format&fit=crop&w=600"
                                    class="w-full h-full object-cover opacity-80 dark:opacity-60">
                                <div
                                    class="absolute top-2 left-2 bg-teal-600 px-2 py-0.5 text-[8px] font-bold rounded uppercase text-white">
                                    ER Entrance - Cam 04</div>
                            </div><button
                                class="w-full py-2 bg-teal-50 dark:bg-slate-800 text-teal-700 dark:text-teal-400 text-[10px] font-black uppercase rounded-lg border border-teal-200 dark:border-slate-700">Xem
                                hệ thống Camera</button>
                        </div>
                        <div class="stat-card flex flex-col">
                            <h4 class="text-[10px] font-bold uppercase mb-4 text-teal-600">Trạng thái Xe cấp cứu</h4>
                            <div class="grid grid-cols-2 gap-2 text-[9px] font-black mb-4 transition-colors"
                                :class="darkMode ? 'text-white' : 'text-slate-700'">
                                <div class="p-2 bg-teal-50 dark:bg-slate-800/40 rounded flex justify-between"><span>Đang
                                        đi</span><span class="text-orange-500">03 <i
                                            class="fas fa-ambulance animate-pulse"></i></span></div>
                                <div class="p-2 bg-teal-50 dark:bg-slate-800/40 rounded flex justify-between"><span>Sẵn
                                        sàng</span><span class="text-teal-600">08 <i class="fas fa-check"></i></span>
                                </div>
                                <div class="p-2 bg-teal-50 dark:bg-slate-800/40 rounded flex justify-between"><span>Bảo
                                        trì</span><span class="text-slate-400">01</span></div>
                                <div class="p-2 bg-teal-50 dark:bg-slate-800/40 rounded flex justify-between"><span>Trực
                                        điểm</span><span class="text-teal-600">02</span></div>
                            </div>
                            <div class="flex-grow min-h-[140px]"><canvas id="chartElevator"></canvas></div>
                        </div>

                        <!-- LIVE HOUSEKEEPING FEED -->
                        <div class="stat-card flex flex-col border-emerald-500/30 bg-emerald-500/5">
                            <h4
                                class="text-[10px] font-bold uppercase mb-4 text-emerald-600 flex justify-between items-center">
                                <span>Giám sát Vệ sinh Live</span>
                                <span class="flex items-center gap-1.5"><span
                                        class="text-[8px] text-slate-400 uppercase" x-text="lastHkUpdate"></span>
                                    <div class="status-dot !bg-emerald-500"></div>
                                </span>
                            </h4>
                            <div class="flex-grow overflow-y-auto space-y-3 pr-1 custom-scroll"
                                style="max-height: 260px;"
                                x-init="if(typeof startHKFlow === 'function') startHKFlow($data)">
                                <template x-for="log in housekeepingLogs" :key="log.time + log.staff">
                                    <div
                                        class="p-3 rounded-xl border border-emerald-500/20 bg-white/50 dark:bg-slate-800/50 shadow-sm transition-all hover:border-emerald-500/50 flex gap-3">

                                        <!-- Thumbnail -->
                                        <div class="w-16 h-16 rounded-lg overflow-hidden bg-slate-200 flex-shrink-0 cursor-pointer"
                                            @click="window.open(log.photo, '_blank')">
                                            <img :src="log.photo || 'Archive/Legacy_Web_App/assets/images/no-photo.jpg'"
                                                class="w-full h-full object-cover">
                                        </div>

                                        <div class="flex-grow">
                                            <div class="flex justify-between items-start mb-1">
                                                <span class="text-[11px] font-black text-slate-800 dark:text-white"
                                                    x-text="log.loc"></span>
                                                <span
                                                    class="text-[7px] font-bold px-1 py-0.5 rounded bg-emerald-100 text-emerald-700 uppercase"
                                                    x-text="log.status"></span>
                                            </div>
                                            <div
                                                class="flex justify-between text-[8px] font-semibold text-slate-500 uppercase tracking-tight">
                                                <span><i class="fas fa-user mr-1"></i> <span
                                                        x-text="log.staff"></span></span>
                                                <span><i class="far fa-clock mr-1"></i> <span
                                                        x-text="log.time"></span></span>
                                            </div>
                                            <div class="text-[8px] mt-1 italic text-slate-400 line-clamp-1"
                                                x-text="log.note"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <div class="stat-card p-4 flex items-center gap-3"><i class="fas fa-lungs text-teal-500"></i>
                            <div>
                                <p class="text-[8px] text-slate-500 uppercase font-bold">Hệ thống Oxy</p>
                                <p class="text-[10px] font-black" :class="darkMode ? 'text-white' : 'text-slate-700'">
                                    98% - Normal</p>
                            </div>
                        </div>
                        <div class="stat-card p-4 flex items-center gap-3 border-orange-200"><i
                                class="fas fa-biohazard text-orange-500"></i>
                            <div>
                                <p class="text-[8px] text-slate-500 uppercase font-bold">Rác y tế</p>
                                <p class="text-[10px] font-black text-orange-600">85% Đầy</p>
                            </div>
                        </div>
                        <div class="stat-card p-4 flex items-center gap-3"><i class="fas fa-tint text-cyan-500"></i>
                            <div>
                                <p class="text-[8px] text-slate-500 uppercase font-bold">Nước RO/Lọc</p>
                                <p class="text-[10px] font-black" :class="darkMode ? 'text-white' : 'text-slate-700'">Ổn
                                    định</p>
                            </div>
                        </div>
                        <div class="stat-card p-4 flex items-center gap-3"><i
                                class="fas fa-stethoscope text-indigo-500"></i>
                            <div>
                                <p class="text-[8px] text-slate-500 uppercase font-bold">Dụng cụ</p>
                                <p class="text-[10px] font-black" :class="darkMode ? 'text-white' : 'text-slate-700'">Đã
                                    khử khuẩn</p>
                            </div>
                        </div>
                        <div class="stat-card p-4 flex items-center gap-3 border-teal-200"><i
                                class="fas fa-shield-virus text-teal-600"></i>
                            <div>
                                <p class="text-[8px] text-slate-500 uppercase font-bold">Áp suất âm</p>
                                <p class="text-[10px] font-black text-teal-600">Active</p>
                            </div>
                        </div>
                    </div>

                    <div class="stat-card overflow-hidden">
                        <div
                            class="p-4 bg-teal-50/50 dark:bg-slate-800/30 border-b dark:border-slate-700 border-teal-100 uppercase text-[10px] font-black text-teal-700">
                            Yêu cầu hỗ trợ khẩn cấp (Nurse Call)</div>
                        <table class="w-full text-left text-[11px]" :class="darkMode ? 'text-white' : 'text-slate-700'">
                            <tbody class="divide-y dark:divide-slate-800/50 divide-teal-50">
                                <tr class="cursor-pointer hover:bg-red-500/5">
                                    <td class="p-4 font-bold text-red-600">Giường 12-A</td>
                                    <td class="p-4 opacity-80 italic">Bệnh nhân đau tức ngực, cần hỗ trợ gấp</td>
                                    <td class="p-4 text-right text-red-600 font-bold uppercase text-[9px]">Khẩn cấp</td>
                                </tr>
                                <tr class="cursor-pointer hover:bg-teal-500/5">
                                    <td class="p-4 font-bold text-teal-600">P-405</td>
                                    <td class="p-4 opacity-80 italic">Yêu cầu thay băng, rửa vết thương</td>
                                    <td class="p-4 text-right"><span
                                            class="bg-teal-100 text-teal-700 px-2 py-0.5 rounded text-[9px] uppercase font-black">Đã
                                            xử lý</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>